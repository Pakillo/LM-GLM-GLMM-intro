## ----------------------------------------------------------------------------------------------------
download.file("https://raw.githubusercontent.com/Pakillo/LM-GLM-GLMM-intro/trees/data/trees.csv",
              destfile = "trees.csv", mode = "wb")


## ----------------------------------------------------------------------------------------------------
trees <- read.csv("trees.csv")
head(trees)


## ----------------------------------------------------------------------------------------------------
plot(trees$height)


## ----------------------------------------------------------------------------------------------------
hist(trees$height)


## ----------------------------------------------------------------------------------------------------
hist(trees$dbh)


## ----------------------------------------------------------------------------------------------------
plot(height ~ dbh, data = trees, las = 1)


## ----------------------------------------------------------------------------------------------------
m1 <- lm(height ~ dbh, data = trees)


## ----------------------------------------------------------------------------------------------------
#| eval: false
## library("equatiomatic")
## m1 <- lm(height ~ dbh, data = trees)
## equatiomatic::extract_eq(m1)


## ----------------------------------------------------------------------------------------------------
#| eval: false
## equatiomatic::extract_eq(m1, use_coefs = TRUE)


## ----------------------------------------------------------------------------------------------------
summary(m1)


## ----------------------------------------------------------------------------------------------------
library("easystats")


## ----------------------------------------------------------------------------------------------------
parameters(m1)[1,]


## ----------------------------------------------------------------------------------------------------
plot(simulate_parameters(m1), show_intercept = TRUE)


## ----------------------------------------------------------------------------------------------------
parameters::parameters(m1)[2,]


## ----------------------------------------------------------------------------------------------------
plot(simulate_parameters(m1))


## ----------------------------------------------------------------------------------------------------
hist(residuals(m1))


## ----------------------------------------------------------------------------------------------------
coef(m1)


## ----------------------------------------------------------------------------------------------------
confint(m1)


## ----------------------------------------------------------------------------------------------------
parameters(m1)


## ----------------------------------------------------------------------------------------------------
report(m1)


## ----------------------------------------------------------------------------------------------------
library("modelsummary")


## ----------------------------------------------------------------------------------------------------
modelsummary(m1, output = "html")  ## Word, PDF, PowerPoint, png...


## ----------------------------------------------------------------------------------------------------
modelsummary(m1, fmt = 2, 
             estimate = "{estimate} ({std.error})", 
             statistic = NULL,
             gof_map = c("nobs", "r.squared", "rmse"),
             output = "html")


## ----------------------------------------------------------------------------------------------------
library("visreg")


## ----------------------------------------------------------------------------------------------------
visreg(m1)


## ----------------------------------------------------------------------------------------------------
#| eval: false
## visreg(m1, gg = TRUE) + theme_bw()


## ----------------------------------------------------------------------------------------------------
plot(estimate_expectation(m1))


## ----------------------------------------------------------------------------------------------------
modelplot(m1)


## ----------------------------------------------------------------------------------------------------
plot(parameters(m1), show_intercept = TRUE, show_labels = TRUE)


## ----------------------------------------------------------------------------------------------------
plot(simulate_parameters(m1))


## ----------------------------------------------------------------------------------------------------
hist(residuals(m1))


## ----------------------------------------------------------------------------------------------------
def.par <- par(no.readonly = TRUE)
layout(matrix(1:4, nrow=2))
plot(m1)
par(def.par)


## ----------------------------------------------------------------------------------------------------
check_model(m1)


## ----------------------------------------------------------------------------------------------------
#| eval: false
## model_dashboard(m1)


## ----------------------------------------------------------------------------------------------------
pred <- estimate_expectation(m1)
head(pred)


## ----------------------------------------------------------------------------------------------------
plot(estimate_expectation(m1))


## ----------------------------------------------------------------------------------------------------
pred$height.obs <- trees$height
plot(height.obs ~ Predicted, data = pred, xlim = c(15, 60), ylim = c(15, 60))
abline(a = 0, b = 1)


## ----------------------------------------------------------------------------------------------------
pred <- estimate_prediction(m1)
head(pred)


## ----------------------------------------------------------------------------------------------------
plot(estimate_expectation(m1))


## ----------------------------------------------------------------------------------------------------
plot(estimate_prediction(m1))


## ----------------------------------------------------------------------------------------------------
estimate_expectation(m1, data = data.frame(dbh = 39))


## ----------------------------------------------------------------------------------------------------
estimate_prediction(m1, data = data.frame(dbh = 39))


## ----------------------------------------------------------------------------------------------------
boxplot(height ~ sex, data = trees)


## ----------------------------------------------------------------------------------------------------
m2 <- lm(height ~ sex, data = trees)
summary(m2)


## ----------------------------------------------------------------------------------------------------
m2 <- lm(height ~ sex, data = trees)


## ----------------------------------------------------------------------------------------------------
m2 <- lm(height ~ sex, data = trees)
summary(m2)


## ----------------------------------------------------------------------------------------------------
report(m2)


## ----------------------------------------------------------------------------------------------------
parameters(m2)[1,]


## ----------------------------------------------------------------------------------------------------
plot(simulate_parameters(m2), show_intercept = TRUE)


## ----------------------------------------------------------------------------------------------------
parameters(m2)[2,]


## ----------------------------------------------------------------------------------------------------
plot(simulate_parameters(m2))


## ----------------------------------------------------------------------------------------------------
estimate_means(m2)


## ----------------------------------------------------------------------------------------------------
estimate_contrasts(m2)


## ----------------------------------------------------------------------------------------------------
visreg(m2)


## ----------------------------------------------------------------------------------------------------
plot(estimate_means(m2))


## ----------------------------------------------------------------------------------------------------
hist(resid(m2))


## ----------------------------------------------------------------------------------------------------
def.par <- par(no.readonly = TRUE)
layout(matrix(1:4, nrow=2))
plot(m2)
par(def.par)


## ----------------------------------------------------------------------------------------------------
check_model(m2)


## ----------------------------------------------------------------------------------------------------
plot(height ~ site, data = trees)


## ----------------------------------------------------------------------------------------------------
m3 <- lm(height ~ site, data = trees)


## ----------------------------------------------------------------------------------------------------
m3 <- lm(height ~ site, data = trees)
summary(m3)


## ----------------------------------------------------------------------------------------------------
trees$site <- as.factor(trees$site)


## ----------------------------------------------------------------------------------------------------
m3 <- lm(height ~ site, data = trees)
summary(m3)


## ----------------------------------------------------------------------------------------------------
plot(simulate_parameters(m3))


## ----------------------------------------------------------------------------------------------------
estimate_means(m3)


## ----------------------------------------------------------------------------------------------------
plot(estimate_means(m3))


## ----------------------------------------------------------------------------------------------------
estimate_contrasts(m3)


## ----------------------------------------------------------------------------------------------------
library("marginaleffects")


## ----------------------------------------------------------------------------------------------------
hypotheses(m3, "site2 = site9")


## ----------------------------------------------------------------------------------------------------
parameters(m3)


## ----------------------------------------------------------------------------------------------------
modelsummary(m3, estimate  = "{estimate} ({std.error})", statistic = NULL, 
             fmt = 1, gof_map = NA, coef_rename = paste0("site", 1:10), output = "html")


## ----------------------------------------------------------------------------------------------------
visreg(m3)


## ----------------------------------------------------------------------------------------------------
plot(estimate_means(m3))


## ----------------------------------------------------------------------------------------------------
modelplot(m3)


## ----------------------------------------------------------------------------------------------------
plot(parameters(m3), show_intercept = TRUE)


## ----------------------------------------------------------------------------------------------------
m3bis <- lm(height ~ site - 1, data = trees)
summary(m3bis)


## ----------------------------------------------------------------------------------------------------
plot(parameters(m3bis))


## ----------------------------------------------------------------------------------------------------
def.par <- par(no.readonly = TRUE)
layout(matrix(1:4, nrow = 2))
plot(m3)
par(def.par)


## ----------------------------------------------------------------------------------------------------
check_model(m3)


## ----------------------------------------------------------------------------------------------------
lm(height ~ site + dbh, data = trees)


## ----------------------------------------------------------------------------------------------------
m4 <- lm(height ~ site + dbh, data = trees)
summary(m4)


## ----------------------------------------------------------------------------------------------------
parameters(m4)


## ----------------------------------------------------------------------------------------------------
estimate_means(m4)


## ----------------------------------------------------------------------------------------------------
m4 <- lm(height ~ -1 + site + dbh, data = trees)
summary(m4)


## ----------------------------------------------------------------------------------------------------
visreg(m4)


## ----------------------------------------------------------------------------------------------------
visreg(m4, xvar = "dbh", by = "site", overlay = TRUE, band = FALSE)


## ----------------------------------------------------------------------------------------------------
plot(parameters(m4))


## ----------------------------------------------------------------------------------------------------
plot(parameters(m4, drop = "dbh"))


## ----------------------------------------------------------------------------------------------------
modelplot(m4)


## ----------------------------------------------------------------------------------------------------
modelplot(m4, coef_omit = "dbh")


## ----------------------------------------------------------------------------------------------------
visreg(m3)


## ----------------------------------------------------------------------------------------------------
visreg(m4, xvar = "site")


## ----------------------------------------------------------------------------------------------------
boxplot(dbh ~ site, data = trees)


## ----------------------------------------------------------------------------------------------------
aggregate(trees$dbh ~ trees$site, FUN = mean)


## ----------------------------------------------------------------------------------------------------
aggregate(trees$height ~ trees$site, FUN = mean)


## ----------------------------------------------------------------------------------------------------
visreg(m4, xvar = "dbh", by = "site", overlay = TRUE, band = FALSE)


## ----------------------------------------------------------------------------------------------------
parameters(m4, keep = "dbh")


## ----------------------------------------------------------------------------------------------------
def.par <- par(no.readonly = TRUE)
layout(matrix(1:4, nrow=2))
plot(m4)
par(def.par)


## ----------------------------------------------------------------------------------------------------
check_model(m4)


## ----------------------------------------------------------------------------------------------------
trees$height.pred <- fitted(m4)
plot(trees$height.pred, trees$height, 
     xlab = "Tree height (predicted)", 
     ylab = "Tree height (observed)", 
     las = 1, xlim = c(10,60), ylim = c(10,60))
abline(a = 0, b = 1)


## ----------------------------------------------------------------------------------------------------
pred <- estimate_expectation(m4)
pred$obs <- trees$height
plot(obs ~ Predicted, data = pred, xlim = c(15, 60), ylim = c(15, 60))
abline(a = 0, b = 1)


## ----------------------------------------------------------------------------------------------------
check_predictions(m4)


## ----------------------------------------------------------------------------------------------------
trees.10cm <- data.frame(site = as.factor(1:10),
                        dbh = 10)
trees.10cm


## ----------------------------------------------------------------------------------------------------
pred <- estimate_expectation(m4, data = trees.10cm)
pred


## ----------------------------------------------------------------------------------------------------
pred <- estimate_prediction(m4, data = trees.10cm)
pred


## ----------------------------------------------------------------------------------------------------
df <- data.frame(dbh = seq(10, 50, by = 1), 
                 height = seq(20, 60, by = 1))

plot(height ~ dbh, data = df, type = "n")
abline(a = 25, 0.6)
abline(a = 40, b = 0.1, col = "steelblue")
abline(a = 50, b = -0.3, col = "orangered")


## ----------------------------------------------------------------------------------------------------
m5 <- lm(height ~ site*dbh, data = trees)
summary(m5)


## ----------------------------------------------------------------------------------------------------
visreg(m5, xvar = "dbh", by = "site")


## ----------------------------------------------------------------------------------------------------
visreg(m5, xvar = "dbh", by = "site", overlay = TRUE, band = FALSE)

